---
import BaseLayout from "../../layouts/BaseLayout.astro";
---

<BaseLayout title="Nestey AI â€” Chat Demo">
  <div class="chat-container">
    <!-- Sidebar -->
    <aside class="chat-sidebar">
      <div class="sidebar-header">
        <button class="new-chat-btn">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M12 5v14M5 12h14"></path>
          </svg>
          New chat
        </button>
      </div>

      <div class="chat-history">
        <div class="history-section">
          <div class="history-label">Today</div>
          <button class="history-item active">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"
              ></path>
            </svg>
            Employee onboarding questions
          </button>
        </div>
      </div>

      <div class="sidebar-footer">
        <button class="user-menu">
          <div class="user-avatar">N</div>
          <span>Demo User</span>
        </button>
      </div>
    </aside>

    <!-- Main Chat Area -->
    <main class="chat-main">
      <div class="chat-header">
        <h1>Nestey AI</h1>
        <span class="model-badge">HR Assistant</span>
      </div>

      <div class="chat-messages" id="chatMessages">
        <div class="welcome-screen">
          <div class="nestey-logo">
            <svg
              width="48"
              height="48"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"
              ></path>
              <path d="M8 10h.01M12 10h.01M16 10h.01"></path>
            </svg>
          </div>
          <h2>How can I help you today?</h2>
          <div class="suggestion-grid">
            <button
              class="suggestion-card"
              data-prompt="How do I request time off?"
            >
              <div class="suggestion-icon">ðŸ“…</div>
              <div class="suggestion-text">Request time off</div>
            </button>
            <button
              class="suggestion-card"
              data-prompt="What are the company holidays?"
            >
              <div class="suggestion-icon">ðŸŽ‰</div>
              <div class="suggestion-text">Company holidays</div>
            </button>
            <button
              class="suggestion-card"
              data-prompt="How do I update my benefits?"
            >
              <div class="suggestion-icon">ðŸ’¼</div>
              <div class="suggestion-text">Update benefits</div>
            </button>
            <button class="suggestion-card" data-prompt="Who is my HR contact?">
              <div class="suggestion-icon">ðŸ‘¤</div>
              <div class="suggestion-text">HR contact info</div>
            </button>
          </div>
        </div>
      </div>

      <div class="chat-input-container">
        <div class="chat-input-wrapper">
          <textarea
            id="chatInput"
            class="chat-input"
            placeholder="Message Nestey AI..."
            rows="1"></textarea>
          <button id="sendBtn" class="send-btn" disabled>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
            </svg>
          </button>
        </div>
        <div class="chat-disclaimer">
          Nestey AI can make mistakes. Consider checking important information.
        </div>
      </div>
    </main>
  </div>
</BaseLayout>

<style>
  :global(body) {
    overflow: hidden;
  }

  .chat-container {
    display: flex;
    height: 100vh;
    background: var(--brand-background);
  }

  /* ============ SIDEBAR ============ */
  .chat-sidebar {
    width: 260px;
    background: var(--brand-blue);
    display: flex;
    flex-direction: column;
    border-right: 1px solid rgba(255, 255, 255, 0.1);
  }

  .sidebar-header {
    padding: 1rem;
  }

  .new-chat-btn {
    width: 100%;
    padding: 0.75rem 1rem;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: white;
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.9rem;
    transition: background 0.2s;
  }

  .new-chat-btn:hover {
    background: rgba(255, 255, 255, 0.15);
  }

  .chat-history {
    flex: 1;
    overflow-y: auto;
    padding: 0.5rem;
  }

  .history-section {
    margin-bottom: 1.5rem;
  }

  .history-label {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.75rem;
    font-weight: 500;
    text-transform: uppercase;
    padding: 0.5rem 0.75rem;
    letter-spacing: 0.5px;
  }

  .history-item {
    width: 100%;
    padding: 0.75rem;
    background: transparent;
    border: none;
    color: rgba(255, 255, 255, 0.8);
    text-align: left;
    border-radius: var(--radius-sm);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-size: 0.9rem;
    transition: background 0.2s;
    margin-bottom: 0.25rem;
  }

  .history-item:hover {
    background: rgba(255, 255, 255, 0.1);
    color: white;
  }

  .history-item.active {
    background: rgba(255, 255, 255, 0.15);
    color: white;
  }

  .sidebar-footer {
    padding: 1rem;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
  }

  .user-menu {
    width: 100%;
    padding: 0.75rem;
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: white;
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    gap: 0.75rem;
    cursor: pointer;
    transition: background 0.2s;
  }

  .user-menu:hover {
    background: rgba(255, 255, 255, 0.1);
  }

  .user-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--brand-blue-accent);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 0.9rem;
  }

  /* ============ MAIN CHAT ============ */
  .chat-main {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: white;
  }

  .chat-header {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--brand-border);
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .chat-header h1 {
    font-size: 1.25rem;
    color: var(--brand-blue);
    margin: 0;
  }

  .model-badge {
    padding: 0.25rem 0.75rem;
    background: var(--brand-accent-superlight);
    color: var(--brand-blue);
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 500;
  }

  .chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 2rem;
  }

  /* ============ WELCOME SCREEN ============ */
  .welcome-screen {
    max-width: 800px;
    margin: auto;
    text-align: center;
  }

  .nestey-logo {
    width: 80px;
    height: 80px;
    margin: 0 auto 1.5rem;
    background: var(--brand-blue);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
  }

  .welcome-screen h2 {
    font-size: 2rem;
    color: var(--brand-blue);
    margin-bottom: 2rem;
  }

  .suggestion-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
    margin-top: 2rem;
  }

  .suggestion-card {
    padding: 1.5rem;
    background: var(--brand-background);
    border: 1px solid var(--brand-border);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all 0.2s;
    text-align: left;
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .suggestion-card:hover {
    background: white;
    border-color: var(--brand-blue-accent);
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .suggestion-icon {
    font-size: 1.5rem;
  }

  .suggestion-text {
    color: var(--text-dark);
    font-weight: 500;
    font-size: 0.95rem;
  }

  /* ============ MESSAGE BUBBLES ============ */
  .chat-messages .message {
    display: flex;
    gap: 0.75rem;
    margin-bottom: 1.25rem;
    animation: fadeIn 0.25s ease;
    max-width: 70%;
    clear: both;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Assistant LEFT */
  .chat-messages .message.assistant {
    float: left;
    flex-direction: row;
  }

  /* User RIGHT */
  .chat-messages .message.user {
    float: right;
    flex-direction: row-reverse;
  }

  /* Avatar */
  .message-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 0.9rem;
  }

  .message.user .message-avatar {
    background: var(--brand-blue-accent);
    color: white;
  }

  .message.assistant .message-avatar {
    background: var(--brand-blue);
    color: white;
  }

  /* Container for text */
  .message-content {
    min-width: 0;
  }

  /* Bubble styling */
  .message-text {
    padding: 1rem 1.25rem;
    border-radius: var(--radius-md);
    line-height: 1.55;
    word-wrap: break-word;
  }

  /* User bubble */
  .message.user .message-text {
    background: var(--brand-blue-accent) !important;
    color: white !important;
  }

  /* Assistant bubble */
  .message.assistant .message-text {
    background: var(--brand-background) !important;
    color: var(--text-dark) !important;
  }

  /* User RIGHT - FORCE IT */
  .message.user {
    margin-left: auto !important;
    margin-right: 0 !important;
    flex-direction: row-reverse !important;
  }

  /* Assistant LEFT - FORCE IT */
  .message.assistant {
    margin-right: auto !important;
    margin-left: 0 !important;
    flex-direction: row !important;
  }

  /* ============ INPUT AREA ============ */
  .chat-input-container {
    padding: 1.5rem;
    border-top: 1px solid var(--brand-border);
    background: white;
  }

  .chat-input-wrapper {
    max-width: 800px;
    margin: 0 auto;
    position: relative;
    display: flex;
    align-items: flex-end;
    gap: 0.5rem;
    background: var(--brand-background);
    border: 1px solid var(--brand-border);
    border-radius: var(--radius-md);
    padding: 0.75rem 1rem;
    transition: border-color 0.2s;
  }

  .chat-input-wrapper:focus-within {
    border-color: var(--brand-blue-accent);
    box-shadow: 0 0 0 3px rgba(58, 122, 254, 0.1);
  }

  .chat-input {
    flex: 1;
    border: none;
    background: transparent;
    resize: none;
    outline: none;
    font-size: 1rem;
    font-family: inherit;
    line-height: 1.5;
    max-height: 200px;
    color: var(--text-dark);
  }

  .chat-input::placeholder {
    color: var(--text-medium);
  }

  .send-btn {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--brand-blue-accent);
    border: none;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    flex-shrink: 0;
  }

  .send-btn:disabled {
    background: var(--brand-border);
    cursor: not-allowed;
  }

  .send-btn:not(:disabled):hover {
    background: #2e63e6;
    transform: scale(1.05);
  }

  .chat-disclaimer {
    text-align: center;
    font-size: 0.75rem;
    color: var(--text-medium);
    margin-top: 0.75rem;
  }

  /* ============ RESPONSIVE ============ */
  @media (max-width: 768px) {
    .chat-sidebar {
      position: absolute;
      left: -260px;
      height: 100%;
      z-index: 1000;
      transition: left 0.3s;
    }

    .chat-sidebar.open {
      left: 0;
    }

    .suggestion-grid {
      grid-template-columns: 1fr;
    }

    .welcome-screen h2 {
      font-size: 1.5rem;
    }
  }
</style>

<script>
  const chatInput = document.getElementById("chatInput") as HTMLTextAreaElement;
  const sendBtn = document.getElementById("sendBtn") as HTMLButtonElement;
  const chatMessages = document.getElementById(
    "chatMessages"
  ) as HTMLDivElement;
  const suggestionCards = document.querySelectorAll(".suggestion-card");

  // Auto-resize textarea
  chatInput.addEventListener("input", () => {
    chatInput.style.height = "auto";
    chatInput.style.height = chatInput.scrollHeight + "px";
    sendBtn.disabled = chatInput.value.trim().length === 0;
  });

  // Handle send message
  function sendMessage(message: string) {
    if (!message.trim()) return;

    // Remove welcome screen if present
    const welcomeScreen = chatMessages.querySelector(".welcome-screen");
    if (welcomeScreen) {
      welcomeScreen.remove();
    }

    // Add user message
    const userMsg = document.createElement("div");
    userMsg.className = "message user";
    userMsg.style.cssText =
      "float: right !important; max-width: 70%; clear: both;";
    userMsg.innerHTML = `
      <div class="message-avatar" style="background: #3A7AFE; color: white; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600;">Me</div>
      <div class="message-content">
        <div class="message-text" style="background: #3A7AFE !important; color: white !important; padding: 0.65rem 1rem; border-radius: 18px; margin-top: 0.5rem;">${escapeHtml(message)}</div>
      </div>
    `;
    chatMessages.appendChild(userMsg);

    // Clear input
    chatInput.value = "";
    chatInput.style.height = "auto";
    sendBtn.disabled = true;

    // Scroll to bottom
    chatMessages.scrollTop = chatMessages.scrollHeight;

    // Simulate AI response
    setTimeout(() => {
      const assistantMsg = document.createElement("div");
      assistantMsg.className = "message assistant";
      assistantMsg.style.cssText =
        "float: left !important; max-width: 70%; clear: both;";
      assistantMsg.innerHTML = `
        <div class="message-avatar" style="width: 44px; height: 44px; min-width: 44px; min-height: 44px; border-radius: 50%; display: flex; align-items: center; justify-content: center; overflow: hidden; padding: 0; flex-shrink: 0;">
          <img src="/icons/nesteyAvatar_144x144.png" alt="Nestey" style="width: 100%; height: 100%; object-fit: cover;" />
        </div>
        <div class="message-content">
          <div class="message-text">${getAIResponse(message)}</div>
        </div>
      `;
      chatMessages.appendChild(assistantMsg);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }, 1000);
  }

  // Send button click
  sendBtn.addEventListener("click", () => {
    sendMessage(chatInput.value);
  });

  // Enter to send (Shift+Enter for new line)
  chatInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      sendMessage(chatInput.value);
    }
  });

  // Suggestion cards
  suggestionCards.forEach((card) => {
    card.addEventListener("click", () => {
      const prompt = (card as HTMLElement).dataset.prompt;
      if (prompt) {
        sendMessage(prompt);
      }
    });
  });

  // Escape HTML
  function escapeHtml(text: string): string {
    const div = document.createElement("div");
    div.textContent = text;
    return div.innerHTML;
  }

  // Simple AI response generator
  function getAIResponse(question: string): string {
    const q = question.toLowerCase();

    if (q.includes("time off") || q.includes("vacation") || q.includes("pto")) {
      return `To request time off in Nestey:<br><br>
        1. Go to the <strong>Time Off</strong> section in your dashboard<br>
        2. Click <strong>"Request Time Off"</strong><br>
        3. Select your dates and time off type (vacation, sick leave, etc.)<br>
        4. Add a note if needed<br>
        5. Submit for approval<br><br>
        Your manager will be notified automatically and you'll receive an update once it's reviewed. You currently have <strong>15 days</strong> of PTO remaining this year.`;
    }

    if (q.includes("holiday") || q.includes("holidays")) {
      return `Here are the company holidays for 2025:<br><br>
        â€¢ New Year's Day - January 1<br>
        â€¢ Memorial Day - May 26<br>
        â€¢ Independence Day - July 4<br>
        â€¢ Labor Day - September 1<br>
        â€¢ Thanksgiving - November 27-28<br>
        â€¢ Christmas - December 25-26<br><br>
        All offices will be closed on these dates. These are paid holidays for full-time employees.`;
    }

    if (q.includes("benefit") || q.includes("benefits")) {
      return `You can update your benefits through Nestey:<br><br>
        1. Navigate to <strong>My Benefits</strong> in the main menu<br>
        2. Review your current elections<br>
        3. Click <strong>"Make Changes"</strong><br>
        4. Update your selections<br><br>
        Note: Benefits changes outside of open enrollment require a qualifying life event (marriage, birth of child, etc.). Open enrollment period is typically in November. Need help? Contact benefits@company.com`;
    }

    if (q.includes("hr contact") || q.includes("hr team")) {
      return `Your HR contacts are:<br><br>
        <strong>Primary HR Business Partner:</strong><br>
        Sarah Johnson - sarah.johnson@company.com<br><br>
        <strong>Benefits Team:</strong><br>
        benefits@company.com<br><br>
        <strong>Payroll Questions:</strong><br>
        payroll@company.com<br><br>
        You can also reach the HR team through the Help Center in Nestey or by calling (555) 123-4567.`;
    }

    return `I'm here to help with your HR questions! I can assist with:<br><br>
      â€¢ Time off requests and PTO balances<br>
      â€¢ Benefits information and enrollment<br>
      â€¢ Company policies and procedures<br>
      â€¢ Payroll and compensation questions<br>
      â€¢ Contact information for HR team<br>
      â€¢ Onboarding and training resources<br><br>
      What would you like to know more about?`;
  }
</script>
